\documentclass[insertoath]{legaldoc}

\setdocumenttitle{Affidavit}

\begin{document}

\begin{luacode}
package.path = package.path .. ";./external/?.lua;./scripts/?.lua"
\end{luacode}


\begin{luacode*}
  local header = require("./scripts/header")
  header.process_case_info("content.json")
  header.print_court_heading()
\end{luacode*}

\begin{tabular*}{\textwidth}{@{}l@{\extracolsep{\fill}}r@{}}
  & \directlua{require("./scripts/header").print_case_no()} \\
    In the matter between: & \\
    \directlua{require("./scripts/header").print_parties()}
\end{tabular*}

\vspace{0.25cm}\hrule\vspace{0.25cm}
\begin{center}
    \textbf{\documenttitle}
\end{center}
\vspace{0.25cm}\hrule\vspace{0.25cm}

\begin{luacode*}
  local process_content = require("scripts/content")
  process_content("content.json")
\end{luacode*}

\parbox{\textwidth}{
  \vspace{0.5cm}
  \directlua{require("./scripts/signatory")()}
}

\ifbool{insertOath}{
  \input{layout/oath}
}{}

\newpage
\begin{spacing}{1}
\directlua{require("./scripts/recipients")("content.json")}
\end{spacing}

\newpage
\begin{luacode}
local annexures_path = "annexures/" -- Folder containing annexures
local p = io.popen('ls "' .. annexures_path .. '"') -- Unix/macOS

if p then
  for file in p:lines() do
    if string.match(file, "%.pdf$") then -- Only include PDFs
      tex.print(string.format("\\InsertAnnexure{%s/%s}", annexures_path, file))
    end
  end
  p:close()
end
\end{luacode}

\end{document}
